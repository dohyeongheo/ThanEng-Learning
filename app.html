<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BKK HUSTLER: REAL DATA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&family=Sarabun:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f2f4f6;
            color: #191f28;
            -webkit-tap-highlight-color: transparent;
        }

        .thai-font {
            font-family: 'Sarabun', sans-serif;
        }

        .card-press:active {
            transform: scale(0.98);
            background-color: #f9fafb;
            transition: 0.1s;
        }

        .tab-active {
            background-color: white;
            color: #3182f6;
            font-weight: 700;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        }

        .tab-inactive {
            color: #8b95a1;
            background-color: transparent;
        }
    </style>
</head>

<body class="h-screen flex flex-col max-w-md mx-auto bg-white sm:bg-[#f2f4f6] sm:shadow-2xl overflow-hidden">

    <!-- VIEW 1: DAY LIST -->
    <div id="view-list" class="flex flex-col h-full bg-[#f2f4f6]">
        <div class="px-6 pt-12 pb-4 bg-white sticky top-0 z-10 rounded-b-3xl shadow-sm">
            <h1 class="text-2xl font-black mb-1">ë°©ì½• ìƒì¡´ ì™„ì„± ğŸ”¥</h1>
            <p class="text-[#8b95a1] text-sm">íƒœêµ­ì–´ & ì˜ì–´ í•™ìŠµ ì•±</p>
        </div>
        <div class="flex-1 overflow-y-auto p-4 space-y-3" id="list-container">
            <div class="flex items-center justify-center h-full">
                <div class="text-center">
                    <i class="fas fa-spinner fa-spin text-4xl text-[#3182f6] mb-4"></i>
                    <p class="text-gray-500">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- VIEW 2: DETAIL -->
    <div id="view-detail" class="hidden flex-col h-full bg-white">
        <!-- Header -->
        <div class="px-4 py-3 border-b border-[#f2f4f6] flex items-center justify-between sticky top-0 bg-white z-20">
            <button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-100" aria-label="ë’¤ë¡œê°€ê¸°"><i
                    class="fas fa-arrow-left text-xl" aria-hidden="true"></i></button>
            <span class="font-bold text-lg" id="header-title">DAY 1</span>
            <div class="w-8"></div>
        </div>

        <!-- Tabs -->
        <div class="px-4 py-3 bg-white z-10">
            <div class="bg-[#f2f4f6] p-1 rounded-xl flex text-sm">
                <button onclick="setTab('th')" id="btn-th" class="flex-1 py-3 rounded-lg tab-active"
                    aria-label="íƒœêµ­ì–´ íƒ­">íƒœêµ­ì–´ (<span id="count-th">0</span>)</button>
                <button onclick="setTab('en')" id="btn-en" class="flex-1 py-3 rounded-lg tab-inactive"
                    aria-label="ì˜ì–´ íƒ­">ì˜ì–´ (<span id="count-en">0</span>)</button>
                <button onclick="setTab('quiz')" id="btn-quiz" class="flex-1 py-3 rounded-lg tab-inactive"
                    aria-label="í€´ì¦ˆ íƒ­">í€´ì¦ˆ (TEST)</button>
            </div>
        </div>

        <!-- Content -->
        <div class="flex-1 overflow-y-auto p-4 space-y-3 pb-10" id="content-area"></div>
    </div>

    <script>
        // ============================================================
        // 0. UTILITY FUNCTIONS
        // ============================================================
        // HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜ (XSS ë°©ì§€)
        function escapeHtml(text) {
            if (text == null) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ============================================================
        // 1. DATA LOADING (from data.json)
        // ============================================================
        let DB = {}; // ë°ì´í„°ë² ì´ìŠ¤ ê°ì²´ (ë™ì ìœ¼ë¡œ ë¡œë“œë¨)

        // data.json íŒŒì¼ ë¡œë“œ
        async function loadData() {
            try {
                const response = await fetch('data.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                DB = data;

                // í‚¤ë¥¼ ìˆ«ìë¡œ ë³€í™˜ (JSONì€ í‚¤ë¥¼ ë¬¸ìì—´ë¡œ ì €ì¥)
                const normalizedDB = {};
                for (const [key, value] of Object.entries(DB)) {
                    normalizedDB[parseInt(key)] = value;
                }
                DB = normalizedDB;

                // ë°ì´í„° ë¡œë“œ ì™„ë£Œ í›„ UI ì—…ë°ì´íŠ¸
                renderList();
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                showError('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
            }
        }

        // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
        function showError(message) {
            const container = document.getElementById('list-container');
            container.innerHTML = `
                <div class="bg-red-50 border border-red-200 p-6 rounded-2xl text-center">
                    <i class="fas fa-exclamation-triangle text-red-500 text-3xl mb-3"></i>
                    <p class="text-red-700 font-bold mb-2">ì˜¤ë¥˜ ë°œìƒ</p>
                    <p class="text-red-600 text-sm">${escapeHtml(message)}</p>
                    <button onclick="location.reload()" class="mt-4 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
                        ìƒˆë¡œê³ ì¹¨
                    </button>
                </div>
            `;
        }

        // ============================================================
        // 2. LOGIC (Quiz Generator & UI)
        // ============================================================
        let currentDay = 1;
        let currentTab = 'th';
        let voices = [];
        let quizAnswered = false; // í€´ì¦ˆ ë‹µë³€ ìƒíƒœ ì¶”ì 
        let scrollPositions = {}; // íƒ­ë³„ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì €ì¥
        let quizLangToggle = true; // true = íƒœêµ­ì–´, false = ì˜ì–´ (ë²ˆê°ˆì•„ê°€ë©°)

        window.onload = function () {
            // ë°ì´í„° ë¡œë“œ
            loadData();

            // Audio Init
            const loadVoices = () => {
                if (window.speechSynthesis) {
                    voices = window.speechSynthesis.getVoices();
                }
            };
            loadVoices();
            if (window.speechSynthesis && speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }

            // ë¸Œë¼ìš°ì € ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ì²˜ë¦¬
            window.addEventListener('popstate', function (event) {
                if (document.getElementById('view-detail').classList.contains('flex')) {
                    goBack();
                }
            });
        };

        function renderList() {
            const container = document.getElementById('list-container');
            let html = '';
            for (const [day, data] of Object.entries(DB)) {
                html += `
                <div onclick="openDay(${day})" class="bg-white p-5 rounded-2xl flex justify-between items-center card-press cursor-pointer border border-transparent hover:border-blue-100 shadow-sm" role="button" tabindex="0" aria-label="DAY ${day}: ${escapeHtml(data.topic)}">
                    <div>
                        <span class="text-[#3182f6] text-xs font-bold block mb-1">DAY ${day}</span>
                        <h3 class="text-lg font-bold text-[#333]">${escapeHtml(data.topic)}</h3>
                    </div>
                    <i class="fas fa-chevron-right text-gray-300" aria-hidden="true"></i>
                </div>`;
            }
            container.innerHTML = html;
        }

        function openDay(day) {
            // ë°ì´í„° ê²€ì¦
            if (!DB[day]) {
                console.error(`Day ${day} ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.`);
                return;
            }

            currentDay = day;
            quizAnswered = false; // í€´ì¦ˆ ìƒíƒœ ì´ˆê¸°í™”
            scrollPositions = {}; // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì´ˆê¸°í™”
            quizLangToggle = true; // í€´ì¦ˆ ì–¸ì–´ í† ê¸€ ì´ˆê¸°í™” (íƒœêµ­ì–´ë¶€í„° ì‹œì‘)

            document.getElementById('view-list').classList.add('hidden');
            document.getElementById('view-detail').classList.remove('hidden');
            document.getElementById('view-detail').classList.add('flex');

            const topic = DB[day].topic.split('(')[0].trim();
            document.getElementById('header-title').textContent = `DAY ${day}: ${topic}`;

            // íƒ­ ê°œìˆ˜ ì—…ë°ì´íŠ¸
            updateTabCounts();
            setTab('th');

            // íˆìŠ¤í† ë¦¬ ê´€ë¦¬ (ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ì§€ì›)
            if (window.history && window.history.pushState) {
                window.history.pushState({ view: 'detail', day: day }, '', `#day-${day}`);
            }
        }

        function updateTabCounts() {
            const data = DB[currentDay];
            if (data) {
                const thCount = data.th ? data.th.length : 0;
                const enCount = data.en ? data.en.length : 0;
                document.getElementById('count-th').textContent = thCount;
                document.getElementById('count-en').textContent = enCount;
            }
        }

        function goBack() {
            document.getElementById('view-detail').classList.remove('flex');
            document.getElementById('view-detail').classList.add('hidden');
            document.getElementById('view-list').classList.remove('hidden');

            // TTS ì¤‘ì§€
            if (window.speechSynthesis) {
                window.speechSynthesis.cancel();
            }

            // íˆìŠ¤í† ë¦¬ ê´€ë¦¬
            if (window.history && window.history.pushState) {
                window.history.pushState(null, null, window.location.pathname);
            }
        }

        function setTab(tab) {
            // ë°ì´í„° ê²€ì¦
            const data = DB[currentDay];
            if (!data) {
                console.error(`Day ${currentDay} ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.`);
                return;
            }

            // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì €ì¥
            const area = document.getElementById('content-area');
            if (currentTab && scrollPositions[currentTab] !== undefined) {
                scrollPositions[currentTab] = area.scrollTop;
            }

            currentTab = tab;
            quizAnswered = false; // í€´ì¦ˆ ìƒíƒœ ì´ˆê¸°í™”

            // Button Styles
            ['th', 'en', 'quiz'].forEach(t => {
                const btn = document.getElementById(`btn-${t}`);
                if (btn) {
                    if (t === tab) {
                        btn.classList.add('tab-active');
                        btn.classList.remove('tab-inactive');
                        btn.setAttribute('aria-selected', 'true');
                    } else {
                        btn.classList.add('tab-inactive');
                        btn.classList.remove('tab-active');
                        btn.setAttribute('aria-selected', 'false');
                    }
                }
            });

            let html = '';

            if (tab === 'th' && data.th) {
                data.th.forEach((item, i) => {
                    if (!item || !item.t) return; // ë¹ˆ ë°ì´í„° ìŠ¤í‚µ
                    const escapedT = escapeHtml(item.t);
                    const escapedK = escapeHtml(item.k || '');
                    const escapedM = escapeHtml(item.m || '');
                    html += `
                    <div onclick="speak('${escapedT.replace(/'/g, "\\'")}', 'th')" class="bg-white p-5 rounded-2xl border border-gray-100 card-press cursor-pointer relative" role="button" tabindex="0" aria-label="íƒœêµ­ì–´ í‘œí˜„ ${i + 1}">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[10px] font-bold text-gray-400 bg-gray-100 px-2 py-1 rounded">#${i + 1}</span>
                            <i class="fas fa-volume-high text-gray-300" aria-hidden="true"></i>
                        </div>
                        <h3 class="text-xl font-bold text-[#333] mb-1 thai-font leading-relaxed">${escapedT}</h3>
                        <p class="text-sm text-[#ef4444] font-bold mb-1">${escapedK}</p>
                        <p class="text-sm text-gray-500">${escapedM}</p>
                    </div>`;
                });
            } else if (tab === 'en' && data.en) {
                data.en.forEach((item, i) => {
                    if (!item || !item.t) return; // ë¹ˆ ë°ì´í„° ìŠ¤í‚µ
                    const escapedT = escapeHtml(item.t);
                    const escapedM = escapeHtml(item.m || '');
                    html += `
                    <div onclick="speak('${escapedT.replace(/'/g, "\\'")}', 'en')" class="bg-white p-5 rounded-2xl border border-gray-100 card-press cursor-pointer relative" role="button" tabindex="0" aria-label="ì˜ì–´ í‘œí˜„ ${i + 1}">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[10px] font-bold text-gray-400 bg-gray-100 px-2 py-1 rounded">#${i + 1}</span>
                            <i class="fas fa-volume-high text-gray-300" aria-hidden="true"></i>
                        </div>
                        <h3 class="text-lg font-bold text-[#333] mb-2 italic serif">"${escapedT}"</h3>
                        <p class="text-sm text-gray-500 font-medium">${escapedM}</p>
                    </div>`;
                });
            } else if (tab === 'quiz') {
                html = renderQuiz(data);
            }

            area.innerHTML = html;

            // ì €ì¥ëœ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ë³µì›
            if (scrollPositions[tab] !== undefined) {
                setTimeout(() => {
                    area.scrollTop = scrollPositions[tab];
                }, 0);
            } else {
                area.scrollTop = 0;
            }
        }

        // --- QUIZ LOGIC (AUTO GENERATOR) ---
        function renderQuiz(data) {
            // ë°ì´í„° ê²€ì¦
            if (!data) {
                return `
                <div class="flex flex-col h-full justify-center items-center">
                    <i class="fas fa-exclamation-triangle text-4xl text-gray-400 mb-4"></i>
                    <p class="text-gray-500">í€´ì¦ˆ ë°ì´í„°ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
                </div>`;
            }

            // íƒœêµ­ì–´/ì˜ì–´ ë²ˆê°ˆì•„ê°€ë©° ì„ íƒ
            const isThai = quizLangToggle;
            quizLangToggle = !quizLangToggle; // ë‹¤ìŒ ë¬¸ì œë¥¼ ìœ„í•´ í† ê¸€

            const sourceData = isThai ? data.th : data.en;
            const langName = isThai ? 'íƒœêµ­ì–´' : 'ì˜ì–´';

            if (!sourceData || sourceData.length === 0) {
                return `
                <div class="flex flex-col h-full justify-center items-center">
                    <i class="fas fa-exclamation-triangle text-4xl text-gray-400 mb-4"></i>
                    <p class="text-gray-500">${langName} í€´ì¦ˆ ë°ì´í„°ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
                </div>`;
            }

            // ìœ íš¨í•œ ë°ì´í„°ë§Œ í•„í„°ë§
            const validItems = sourceData.filter(item => {
                if (!item || !item.m) return false;
                if (isThai) {
                    return item.t && item.k && item.m && item.t !== "(ë°ì´í„° ì¤€ë¹„ì¤‘)";
                } else {
                    return item.t && item.m && item.t !== "(Coming Soon)";
                }
            });

            if (validItems.length === 0) {
                return `
                <div class="flex flex-col h-full justify-center items-center">
                    <i class="fas fa-exclamation-triangle text-4xl text-gray-400 mb-4"></i>
                    <p class="text-gray-500">${langName} í€´ì¦ˆ ë°ì´í„°ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
                </div>`;
            }

            // ëœë¤ ë¬¸ì œ ì„ íƒ
            const idx = Math.floor(Math.random() * validItems.length);
            const qItem = validItems[idx];

            // í€´ì¦ˆ íƒ€ì… ëœë¤ ì„ íƒ (2ê°€ì§€ íƒ€ì…)
            const quizType = Math.random() < 0.5 ? 1 : 2;
            let questionText = '';
            let correctAnswer = '';
            let options = [];
            let correctIndex = 0;

            if (isThai) {
                // íƒœêµ­ì–´ í€´ì¦ˆ
                if (quizType === 1) {
                    // Type 1: í•œêµ­ì–´ ì˜ë¯¸ â†’ íƒœêµ­ì–´ í•œê¸€ ë°œìŒ(k) ì„ íƒ
                    questionText = `"${escapeHtml(qItem.m)}"ì˜ ${langName} í•œê¸€ ë°œìŒì€?`;
                    correctAnswer = qItem.k;

                    // ì˜¤ë‹µ ìƒì„±
                    const wrongIndices = [];
                    while (wrongIndices.length < 3) {
                        const wrongIdx = Math.floor(Math.random() * validItems.length);
                        if (wrongIdx !== idx && !wrongIndices.includes(wrongIdx) && validItems[wrongIdx].k) {
                            wrongIndices.push(wrongIdx);
                        }
                    }
                    options = [qItem.k, validItems[wrongIndices[0]].k, validItems[wrongIndices[1]].k, validItems[wrongIndices[2]].k];
                } else {
                    // Type 2: íƒœêµ­ì–´ í•œê¸€ ë°œìŒ(k) â†’ í•œêµ­ì–´ ì˜ë¯¸ ì„ íƒ
                    questionText = `"${escapeHtml(qItem.k)}"ì˜ ì˜ë¯¸ëŠ”?`;
                    correctAnswer = qItem.m;

                    // ì˜¤ë‹µ ìƒì„±
                    const wrongIndices = [];
                    while (wrongIndices.length < 3) {
                        const wrongIdx = Math.floor(Math.random() * validItems.length);
                        if (wrongIdx !== idx && !wrongIndices.includes(wrongIdx)) {
                            wrongIndices.push(wrongIdx);
                        }
                    }
                    options = [qItem.m, validItems[wrongIndices[0]].m, validItems[wrongIndices[1]].m, validItems[wrongIndices[2]].m];
                }
            } else {
                // ì˜ì–´ í€´ì¦ˆ
                if (quizType === 1) {
                    // Type 1: í•œêµ­ì–´ ì˜ë¯¸ â†’ ì˜ì–´ ì„ íƒ
                    questionText = `"${escapeHtml(qItem.m)}"ì˜ ${langName} í‘œí˜„ì€?`;
                    correctAnswer = qItem.t;

                    // ì˜¤ë‹µ ìƒì„±
                    const wrongIndices = [];
                    while (wrongIndices.length < 3) {
                        const wrongIdx = Math.floor(Math.random() * validItems.length);
                        if (wrongIdx !== idx && !wrongIndices.includes(wrongIdx)) {
                            wrongIndices.push(wrongIdx);
                        }
                    }
                    options = [qItem.t, validItems[wrongIndices[0]].t, validItems[wrongIndices[1]].t, validItems[wrongIndices[2]].t];
                } else {
                    // Type 2: ì˜ì–´ â†’ í•œêµ­ì–´ ì˜ë¯¸ ì„ íƒ
                    questionText = `"${escapeHtml(qItem.t)}"ì˜ ì˜ë¯¸ëŠ”?`;
                    correctAnswer = qItem.m;

                    // ì˜¤ë‹µ ìƒì„±
                    const wrongIndices = [];
                    while (wrongIndices.length < 3) {
                        const wrongIdx = Math.floor(Math.random() * validItems.length);
                        if (wrongIdx !== idx && !wrongIndices.includes(wrongIdx)) {
                            wrongIndices.push(wrongIdx);
                        }
                    }
                    options = [qItem.m, validItems[wrongIndices[0]].m, validItems[wrongIndices[1]].m, validItems[wrongIndices[2]].m];
                }
            }

            // ì„ íƒì§€ ì„ê¸°
            options.sort(() => Math.random() - 0.5);
            correctIndex = options.indexOf(correctAnswer);
            const escapedOpts = options.map(opt => escapeHtml(opt));

            return `
            <div class="flex flex-col h-full justify-center">
                <div class="text-center mb-8">
                    <i class="fas fa-brain text-4xl text-yellow-400 mb-4" aria-hidden="true"></i>
                    <h2 class="text-xl font-bold mb-2">${langName} í€´ì¦ˆ</h2>
                    <p class="text-gray-400 text-sm">ëœë¤ìœ¼ë¡œ ë¬¸ì œê°€ ìƒì„±ë©ë‹ˆë‹¤</p>
                </div>

                <div class="bg-white border border-blue-100 p-8 rounded-2xl text-center shadow-sm mb-6">
                    <p class="text-sm text-gray-500 mb-2">${questionText}</p>
                    ${isThai && quizType === 2 ? `<h3 class="text-2xl font-bold text-[#3182f6] mb-2">${escapeHtml(qItem.k)}</h3>` : ''}
                    ${!isThai && quizType === 2 ? `<h3 class="text-xl font-bold text-[#3182f6] mb-2 italic">"${escapeHtml(qItem.t)}"</h3>` : ''}
                </div>

                <div class="space-y-3" id="quiz-options">
                    ${escapedOpts.map((opt, i) => `
                        <button onclick="checkAns(this, ${i === correctIndex}, ${correctIndex})"
                                class="quiz-option w-full p-4 bg-white border border-gray-200 rounded-xl font-bold text-gray-600 hover:bg-gray-50 transition-colors text-left"
                                role="button"
                                aria-label="ì„ íƒì§€ ${i + 1}: ${opt}">
                            ${opt}
                        </button>
                    `).join('')}
                </div>
                <div class="mt-8 text-center">
                     <button onclick="setTab('quiz')" class="text-sm text-gray-400 underline hover:text-gray-600" aria-label="ë‹¤ìŒ ë¬¸ì œ">ë‹¤ìŒ ë¬¸ì œ (ìƒˆë¡œê³ ì¹¨)</button>
                </div>
            </div>`;
        }

        function checkAns(btn, isCorrect, correctIndex) {
            // ì´ë¯¸ ì •ë‹µì„ ë§ì¶˜ ê²½ìš° ë¬´ì‹œ
            if (quizAnswered) {
                return;
            }

            const options = document.querySelectorAll('.quiz-option');

            if (isCorrect) {
                // ì •ë‹µ ì²˜ë¦¬
                quizAnswered = true;

                // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
                options.forEach(opt => {
                    opt.style.pointerEvents = 'none';
                    opt.disabled = true;
                });

                btn.style.backgroundColor = '#dbeafe'; // Blue-100
                btn.style.borderColor = '#3b82f6';
                btn.style.color = '#1d4ed8';
                btn.innerHTML += ' <i class="fas fa-check float-right mt-1" aria-hidden="true"></i>';
                btn.setAttribute('aria-label', btn.getAttribute('aria-label') + ' - ì •ë‹µ');

                // ê¸°ì¡´ ë©”ì‹œì§€ ì œê±°
                const existingMessage = document.querySelector('.quiz-message');
                if (existingMessage) {
                    existingMessage.remove();
                }

                // ì •ë‹µ ë©”ì‹œì§€ í‘œì‹œ
                const quizContainer = document.querySelector('.flex.flex-col.h-full.justify-center');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'quiz-message text-center mt-4';
                messageDiv.innerHTML = '<p class="text-green-600 font-bold text-lg animate-pulse">âœ“ ì •ë‹µì…ë‹ˆë‹¤!</p>';
                quizContainer.querySelector('.space-y-3').after(messageDiv);

                // 1.5ì´ˆ í›„ ìë™ìœ¼ë¡œ ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™
                setTimeout(() => {
                    setTab('quiz');
                }, 1500);
            } else {
                // ì˜¤ë‹µ ì²˜ë¦¬ - ì˜¤ë‹µ ë²„íŠ¼ë§Œ ë¹„í™œì„±í™”í•˜ê³  ë‹¤ë¥¸ ì„ íƒì§€ëŠ” ê³„ì† ì„ íƒ ê°€ëŠ¥
                btn.style.pointerEvents = 'none';
                btn.disabled = true;
                btn.style.backgroundColor = '#fee2e2'; // Red-100
                btn.style.borderColor = '#ef4444';
                btn.style.color = '#b91c1c';

                // ì´ë¯¸ X ì•„ì´ì½˜ì´ ìˆëŠ”ì§€ í™•ì¸
                if (!btn.innerHTML.includes('fa-times')) {
                    btn.innerHTML += ' <i class="fas fa-times float-right mt-1" aria-hidden="true"></i>';
                }
                btn.setAttribute('aria-label', btn.getAttribute('aria-label') + ' - ì˜¤ë‹µ');

                // ê¸°ì¡´ ë©”ì‹œì§€ ì œê±°
                const existingMessage = document.querySelector('.quiz-message');
                if (existingMessage) {
                    existingMessage.remove();
                }

                // ì˜¤ë‹µ ë©”ì‹œì§€ í‘œì‹œ
                const quizContainer = document.querySelector('.flex.flex-col.h-full.justify-center');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'quiz-message text-center mt-4';
                messageDiv.innerHTML = '<p class="text-red-600 font-bold text-lg">âœ— í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì„ íƒí•´ë³´ì„¸ìš”!</p>';
                quizContainer.querySelector('.space-y-3').after(messageDiv);
            }
        }

        // --- TTS ENGINE ---
        function speak(text, lang) {
            // TTS ì§€ì› ì—¬ë¶€ í™•ì¸
            if (!window.speechSynthesis) {
                console.warn('ì´ ë¸Œë¼ìš°ì €ëŠ” TTSë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }

            try {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(text);
                u.rate = 0.85;
                u.volume = 1.0;
                u.pitch = 1.0;

                if (lang === 'th') {
                    u.lang = 'th-TH';
                    const v = voices.find(v => v.lang === 'th-TH' || v.lang.startsWith('th'));
                    if (v) u.voice = v;
                } else {
                    u.lang = 'en-US';
                    const v = voices.find(v => v.lang === 'en-US' || v.lang.startsWith('en'));
                    if (v) u.voice = v;
                }

                // ì—ëŸ¬ í•¸ë“¤ë§
                u.onerror = function (event) {
                    console.error('TTS ì—ëŸ¬:', event.error);
                };

                window.speechSynthesis.speak(u);
            } catch (error) {
                console.error('TTS ì‹¤í–‰ ì¤‘ ì—ëŸ¬:', error);
            }
        }
    </script>
</body>

</html>
